<html>
	<head>
	
	<link href="//gmpg.org/xfn/11" rel="profile">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<link rel="canonical" href="http://atomic111.github.io/article/homematic-ccu2-untrusted_addon" />
	<meta name="description" content="# Background HomeMatic is a home automation system consisting of various components for automating several parts of a building, including..." />
	<meta property="og:description" content="# Background HomeMatic is a home automation system consisting of various components for automating several parts of a building, including..." />
	<meta itemprop="image" content="http://atomic111.github.io/assets/article_images/2016-05-30-inspec-cis-docker/cover.jpeg" />
	<meta property="og:image" content="http://atomic111.github.io/assets/article_images/2016-05-30-inspec-cis-docker/cover.jpeg" />
	<meta property="og:title" content="CVE-2018-7299: Untrusted Addon Installation / Remote Code Execution in HomeMatic CCU2" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="http://atomic111.github.io/article/homematic-ccu2-untrusted_addon" />
	<meta property="og:site_name" content="Patrick Münch Blog" />
	<title>CVE-2018-7299: Untrusted Addon Installation / Remote Code Execution in HomeMatic CCU2 &middot; Patrick Münch Blog</title>
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" media="only screen and (min-width: 900px)" href="/assets/css/desktop.css" />
	<link rel="stylesheet" type="text/css" media="only screen and (max-width: 899px)" href="/assets/css/mobile.css" />
	<link href="/assets/css/genericons.css" type="text/css" rel="stylesheet" />
	<link href="/assets/css/syntax.css" type="text/css" rel="stylesheet" />
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fenix:400,400italic">
	<link rel="apple-touch-icon" href="http://atomic111.github.io/assets/images/logo.jpeg">
	<link rel="shortcut icon" href="http://atomic111.github.io/assets/images/favicon.ico">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://atomic111.github.io/atom.xml">
	<script type="text/javascript" src="/assets/js/jquery-2.1.0.min.js"></script>
	
	<script type="text/javascript" src="/assets/js/jquery.stellar.min.js"></script>
	
	
	<!-- Asynchronous Google Analytics snippet -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-114726397-1', 'auto');
		ga('send', 'pageview');
	</script>
	
	<!-- Theme Color for Chrome on Android Lollipop -->
	<meta name="theme-color" content="#302F2D">
</head>

	<body>
		<header class="clean" style="background-image: url(/assets/article_images/2016-05-30-inspec-cis-docker/cover.jpeg); height: 100%; " data-stellar-background-ratio="0.5" data-stellar-horizontal-offset="50">
	
	<label class="menu" for="_1">
	<span class="genericon genericon-menu"></span>
</label>
<input id="_1" type="checkbox">
<div class="menu-content">
	<p class="menu-title">Patrick Münch Blog<p>
	<div class="menu" style="background-color: #1a1a1a; z-index: -1;"></div>
	
		<a href="/">Home</a>
	
	<hr>
	<a href="https://twitter.com/atomiczero111" class="social-links-menu" target="_blank" title="Follow me on twitter"><span class="genericon genericon-twitter"></span></a><a href="https://github.com/atomic111" class="social-links-menu" target="_blank" title="Fork me on github"><span class="genericon genericon-github"></span></a>
</div>
<div class="social-links" data-stellar-ratio="0.1">
	
		<a href="https://twitter.com/atomiczero111" target="_blank" title="Follow me on twitter"><span class="genericon genericon-twitter"></span></a>
	
		<a href="https://github.com/atomic111" target="_blank" title="Fork me on github"><span class="genericon genericon-github"></span></a>
	
</div>

	<div id="post-info" data-stellar-ratio="0.7">
		<h1>CVE-2018-7299: Untrusted Addon Installation / Remote Code Execution in HomeMatic CCU2</h1>
		
		<a class="site-title" href="https://twitter.com/atomiczero111"><div class="site-icon-small" style="background-image: url(https://avatars0.githubusercontent.com/u/7220740?s=400);"></div>Patrick Münch</a>, in 21 February 2018
	</div>
	
	<div id="nav-icon" style="bottom: 30px;" data-stellar-ratio="4">
		<a class="scroll" data-speed="500" href="#article"><span class="genericon genericon-expand"></span></a>
	</div>
</header>
<div id="middle">
	<div id="article">
		<h1 id="background">Background</h1>

<p>HomeMatic is a home automation system consisting of various components for automating several parts of a building, including different sensors and actuators. The HomeMatic CCU2 is a central control unit, which is responsible for integrating these components with each other.</p>

<p>From the vendor’s website (<a href="http://www.eq-3.de/produkte/homematic/zentralen-und-gateways.html">eQ-3</a>):</p>

<p>“The Homematic Central Control Unit CCU2 is responsible for numerous control, signalling and supervision functions across all areas of the Homematic system. The device includes a browser based user interface to the up the system. It can be controlled in the local network as well as via Internet. The Homematic software offers various configuration and application possibilities, so that there are no limits to creativity for installing your individual smart home.”</p>

<h1 id="issue-description">Issue Description</h1>

<p>While analyzing the implementation of the CCU2’s web interface, in particular the addon installation process and how to build own addon-packages, a remote code execution vulnerability has been identified.</p>

<p>An authenticated user can upload addon packages, which contain an update_script file. This update_script file will be executed during the addon installation process. This means that an attacker can create or overwrite arbitrary files or install malicious software.</p>

<p>This vulnerability can be exploited in order to execute arbitrary code on the system. An attacker can for instance overwrite the <code>/usr/local/crontabs/root</code> crontab in order to reach this goal.</p>

<p>This can in particular be problematic if users install untrusted addons from remote sources. It might be advisable to introduce a signing scheme for trusted addons and to warn the user in case they install untrusted or unsigned addons, which could contain malicious code.</p>

<p>Procedure:</p>

<ul>
  <li>Create a file named update_script containing malicious code</li>
  <li>Pack the addon package</li>
  <li>Upload the addon package via the Homematic CCU2 web interface</li>
</ul>

<h1 id="cve">CVE</h1>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7299">CVE-2018-7299</a></p>

<h1 id="cvssv3-base-score">CVSSv3 Base Score</h1>

<p>CVSS Base Score: <strong>4.9</strong></p>

<p>CVSS:3.0/AV:A/AC:L/PR:L/UI:R/S:U/C:L/I:L/A:L</p>

<h1 id="credit">Credit</h1>

<p>Patrick Muench of <a href="https://www.sva.de">SVA System Vertrieb Alexander GmbH</a></p>

<p>Gregor Kopf of <a href="https://secfault-security.com">Secfault Security GmbH</a></p>

<h1 id="disclaimer">Disclaimer</h1>

<p>The information provided is released “as is” without warranty of any kind. The publisher disclaims all warranties, either express or implied, including all warranties of merchantability. No responsibility is taken for the correctness of this information. In no event shall the publisher be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if the publisher has been advised of the possibility of such damages.</p>

<p>The contents of this advisory are copyright (c) 2017 Secfault Security GmbH &amp; SVA System Vertrieb Alexander GmbH and may be distributed freely provided that no fee is charged for this distribution and proper credit is given.</p>

	</div>
	
	<div id="comments">
		
	
	<script src="https://apis.google.com/js/plusone.js"></script>
	<div id="g-comments" class="g-comments" data-href="http://atomic111.github.io/article/homematic-ccu2-untrusted_addon" data-width="700" data-first_party_property="BLOGGER" data-view_type="FILTERED_POSTMOD"></div>
	<script>
		var width = $('#comments').width() * 0.9;
		width = Math.round(width);
		$("#g-comments").attr({ "data-width": width });
	</script>


	</div>
	
	<div class="social center">
		<div class="network">
		<a class="hn-link" href="javascript:window.location=%22http://news.ycombinator.com/submitlink?u=%22+encodeURIComponent(document.location)+%22&amp;t=%22+encodeURIComponent(document.title)">Discuss on Hacker News</a>
		</div>
		<div class="network twitter">
		<a href="https://twitter.com/share" class="twitter-share-button" data-via="atomiczero111" data-count="none">Tweet</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
		</div>
	</div>
</div>

	
	
	
	
	
	


<footer class="clean" style="background-image: url(/assets/article_images/2016-05-30-inspec-cis-docker/cover.jpeg); height: 75%; min-height: 500px; " data-stellar-background-ratio="0.5" data-stellar-horizontal-offset="50" data-stellar-vertical-offset="50">
	<div id="nav-icon" style="top: 60px;" data-stellar-ratio="0.8">
		<a class="scroll" data-speed="500" href="#article"><span class="genericon genericon-collapse"></span></a>
	</div>
	<div id="post-info" data-stellar-ratio="0.5" data-stellar-vertical-offset="120">
		<h3>Read next</h3>
		<a href="/article/homematic-ccu2-filewrite">
			<h1>CVE-2018-7300: Arbitrary File Upload / Remote Code Execution in HomeMatic CCU2</h1>
			
				<h2></h2>
			
		</a>
	</div>
	<p class="copyright">&copy;2018, <a href="http://atomic111.github.io" target="_blank">Patrick Münch</a>. <a href="" target="_blank">All rights reserved</a>.</p>
</footer>
<script src="/assets/js/smooth-scroll.js"></script>

		<script>
		var width = $(window).width()
		if ( width > 899 )
		$( function(){
			$.stellar({
				responsive: true,
			verticalScrolling: true,
			horizontalOffset: 0,
			verticalOffset: 0,
			positionProperty: 'transform',
			});
		});
		</script>
	</body>
</html>
